!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("epoll")):"function"==typeof define&&define.amd?define("pi-home-gpio",["epoll"],e):"object"==typeof exports?exports["pi-home-gpio"]=e(require("epoll")):t["pi-home-gpio"]=e(t[void 0])}(global,(function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";const r=n(1),o=n(2),i=n(3).Epoll,c=Buffer.from("1"),u=Buffer.from("0");class f{constructor(t,e,n,c){"object"!=typeof n||c||(c=n,n=void 0),c=c||{},this._gpio=t,this._gpioPath="/sys/class/gpio/gpio"+this._gpio+"/",this._debounceTimeout=c.debounceTimeout||0,this._readBuffer=Buffer.alloc(16),this._readSyncBuffer=Buffer.alloc(16),this._listeners=[];const u=(t=>!!r.existsSync(t._gpioPath)||(r.writeFileSync("/sys/class/gpio/export",""+t._gpio),!1))(this);((t,e,n,o)=>{let i=[t._gpioPath+"value"];!1===o&&(i.push(t._gpioPath+"direction"),i.push(t._gpioPath+"active_low"),n&&"in"===e&&i.push(t._gpioPath+"edge")),i.forEach(t=>{let e=0;for(;;)try{e+=1;const n=r.openSync(t,"r+");r.closeSync(n);break}catch(t){if(1e4===e)throw t}})})(this,e,n,u),((t,e,n,r,o)=>{const i=t=>{if(!1===o)throw t};try{"boolean"==typeof r.activeLow&&t.setActiveLow(r.activeLow)}catch(t){i(t)}try{const n="boolean"!=typeof r.reconfigureDirection||r.reconfigureDirection,o="high"===e||"low"===e?"out":e;(n||t.direction()!==o)&&t.setDirection(e)}catch(t){i(t)}try{n&&"in"===e&&t.setEdge(n)}catch(t){i(t)}})(this,e,n,c,u),this._valueFd=r.openSync(this._gpioPath+"value","r+"),(t=>{const e=(e,n,r)=>{const o=t.readSync();(0===o&&t._fallingEnabled||1===o&&t._risingEnabled)&&t._listeners.slice(0).forEach(t=>{t(e,o)})};if(t.readSync(),t._debounceTimeout>0){const n=o(e,t._debounceTimeout);t._poller=new i((e,r,o)=>{t.readSync(),n(e,r,o)})}else t._poller=new i(e)})(this)}read(t){const e=t=>{r.read(this._valueFd,this._readBuffer,0,1,0,(e,n,r)=>{if("function"==typeof t){if(e)return t(e);t(null,l(r))}})};if(!t)return new Promise((t,n)=>{e((e,r)=>{e?n(e):t(r)})});e(t)}readSync(){return r.readSync(this._valueFd,this._readSyncBuffer,0,1,0),l(this._readSyncBuffer)}write(t,e){const n=(t,e)=>{const n=s(t);r.write(this._valueFd,n,0,n.length,0,e)};if(!e)return new Promise((e,r)=>{n(t,t=>{t?r(t):e()})});n(t,e)}writeSync(t){const e=s(t);r.writeSync(this._valueFd,e,0,e.length,0)}watch(t){this._listeners.push(t),1===this._listeners.length&&this._poller.add(this._valueFd,i.EPOLLPRI)}unwatch(t){this._listeners.length>0&&(this._listeners="function"!=typeof t?[]:this._listeners.filter(e=>t!==e),0===this._listeners.length&&this._poller.remove(this._valueFd))}unwatchAll(){this.unwatch()}direction(){return r.readFileSync(this._gpioPath+"direction").toString().trim()}setDirection(t){r.writeFileSync(this._gpioPath+"direction",t)}edge(){return r.readFileSync(this._gpioPath+"edge").toString().trim()}setEdge(t){r.writeFileSync(this._gpioPath+"edge",t),this._risingEnabled="both"===t||"rising"===t,this._fallingEnabled="both"===t||"falling"===t}activeLow(){return p(r.readFileSync(this._gpioPath+"active_low"))}setActiveLow(t){r.writeFileSync(this._gpioPath+"active_low",a(!!t))}unexport(){this.unwatchAll(),r.closeSync(this._valueFd);try{r.writeFileSync("/sys/class/gpio/unexport",""+this._gpio)}catch(t){}}static get accessible(){let t;try{t=r.openSync("/sys/class/gpio/export","r+")}catch(t){return!1}finally{t&&r.closeSync(t)}return!0}}const s=t=>a(1===t),l=t=>p(t)?1:0,a=t=>t?c:u,p=t=>t[0]===c[0];f.HIGH=1,f.LOW=0,t.exports.Gpio=f},function(t,e){t.exports=require("fs")},function(t,e){var n=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,s=u||f||Function("return this")(),l=Object.prototype.toString,a=Math.max,p=Math.min,y=function(){return s.Date.now()};function h(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function b(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==l.call(t)}(t))return NaN;if(h(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=h(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var u=o.test(t);return u||i.test(t)?c(t.slice(2),u?2:8):r.test(t)?NaN:+t}t.exports=function(t,e,n){var r,o,i,c,u,f,s=0,l=!1,d=!1,g=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var n=r,i=o;return r=o=void 0,s=e,c=t.apply(i,n)}function _(t){return s=t,u=setTimeout(S,e),l?v(t):c}function w(t){var n=t-f;return void 0===f||n>=e||n<0||d&&t-s>=i}function S(){var t=y();if(w(t))return m(t);u=setTimeout(S,function(t){var n=e-(t-f);return d?p(n,i-(t-s)):n}(t))}function m(t){return u=void 0,g&&r?v(t):(r=o=void 0,c)}function O(){var t=y(),n=w(t);if(r=arguments,o=this,f=t,n){if(void 0===u)return _(f);if(d)return u=setTimeout(S,e),v(f)}return void 0===u&&(u=setTimeout(S,e)),c}return e=b(e)||0,h(n)&&(l=!!n.leading,i=(d="maxWait"in n)?a(b(n.maxWait)||0,e):i,g="trailing"in n?!!n.trailing:g),O.cancel=function(){void 0!==u&&clearTimeout(u),s=0,r=f=o=u=void 0},O.flush=function(){return void 0===u?c:m(y())},O}},function(e,n){e.exports=t},function(t,e,n){"use strict";n.r(e),n.d(e,"Led",(function(){return b})),n.d(e,"PushButton",(function(){return x})),n.d(e,"ToggleButton",(function(){return E})),n.d(e,"isAccessible",(function(){return T}));var r=n(0);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=function t(){var e=this;o(this,t),i(this,"value",0),i(this,"writeSync",(function(t){"true"===process.env.DEBUG&&console.log("writeSync(".concat(t,")")),e.value=t})),i(this,"readSync",(function(){return"true"===process.env.DEBUG&&console.log("readSync => ".concat(e.value)),e.value})),i(this,"watch",(function(t){"true"===process.env.DEBUG&&console.log("watch")}))},u=function t(e,n,u,f){o(this,t),i(this,"_pin",void 0),r.Gpio.accessible?this._pin=new r.Gpio(e,n,u,f):this._pin=new c};function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var o=y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}}function a(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(n,t);var e=l(n);function n(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),h(p(o=e.call(this,t,"out")),"on",(function(){return o._pin.writeSync(r.Gpio.HIGH)})),h(p(o),"off",(function(){return o._pin.writeSync(r.Gpio.LOW)})),h(p(o),"toggle",(function(){return o._pin.writeSync(1^o._pin.readSync())})),h(p(o),"value",(function(t){if(void 0===t)return o._pin.readSync();o._pin.writeSync(t)})),o}return n}(u);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O(t);if(e){var o=O(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return S(this,n)}}function S(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?m(t):e}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(t){v(n,t);var e=w(n);function n(){var t;g(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return j(m(t=e.call.apply(e,[this].concat(o))),"onAction",(function(e){t._pin.watch((function(t,n){"true"===process.env.DEBUG&&console.log("button.watch(".concat(t,", ").concat(n,")")),e(n)}))})),t}return n}(u),x=function(t){v(n,t);var e=w(n);function n(t){return g(this,n),e.call(this,t,"in","rising",{debounceTimeout:10})}return n}(P),E=function(t){v(n,t);var e=w(n);function n(t){return g(this,n),e.call(this,t,"in","both")}return n}(P),T=r.Gpio.accessible}])}));